<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      lang="es">

    <h:head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <title>Gestión de Envíos - Romar Natural</title>

        <!-- Bootstrap, iconos y fuentes -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" />
        <link href="https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;600&amp;display=swap" rel="stylesheet" />
        <link rel="stylesheet" href="#{request.contextPath}/resources/css/style.css" />
    </h:head>

    <h:body>
        <div class="d-flex" style="min-height: 100vh;">

            <!-- Sidebar -->
            <div id="sidebar-container" class="bg-primary text-light">
                <!-- Logo con padding y centrado -->
                <div class="logo p-3">
                    <h4 class="text-light font-weight-bold text-center mb-0">Romar Natural</h4>
                </div>
                <!-- Menú con margen superior -->
                <div class="menu mt-4">
                    <h:link outcome="/operario.xhtml" styleClass="d-block text-light p-3 active">
                        <i class="icon ion-md-apps mr-2 lead"></i>Dashboard
                    </h:link>

                    <h:link outcome="/proveedor/indexoperario.xhtml" styleClass="d-block text-light p-3">
                        <i class="icon ion-md-cube mr-2 lead"></i>Proveedores
                    </h:link>

                    <h:link outcome="/ventas/listarVentas.xhtml" styleClass="d-block text-light p-3">
                        <i class="icon ion-md-cart mr-2 lead"></i>Ventas
                    </h:link>

                    <h:link outcome="/producto/indexoperario.xhtml" styleClass="d-block text-light p-3">
                        <i class="icon ion-md-folder mr-2 lead"></i>Productos
                    </h:link>

                    <h:link outcome="/mensajeria/listarMensajeriaoperario" styleClass="d-block text-light p-3">
                        <i class="icon ion-md-paper-plane mr-2 lead"></i>Mensajería
                    </h:link>

                    <h:link outcome="/envios/listarEnviosoperario" styleClass="d-block text-light p-3">
                        <i class="icon ion-md-send mr-2 lead"></i>Envíos
                    </h:link>
                </div>
            </div>
            <!-- Contenido principal -->
            <div class="flex-grow-1 bg-light">

                <!-- Navbar -->
                <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm">
                    <div class="container-fluid">
                        <form class="form-inline my-2 my-lg-0 ml-0 d-flex align-items-center">
                            <input id="globalSearch"
                                   class="form-control mr-2 search-input"
                                   type="search"
                                   placeholder="Buscar envío"
                                   aria-label="Buscar"
                                   onkeyup="filtrarEnvios()" />
                            <button class="btn btn-outline-success my-2 my-sm-0" type="button" onclick="filtrarEnvios()">
                                <i class="icon ion-md-search"></i>
                            </button>
                        </form>

                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown">Operario</a>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <h:form>
                                        <p:commandButton value="Cerrar Sesión"
                                                         action="#{usuariosBean.cerrarSesion}"
                                                         ajax="false"
                                                         styleClass="dropdown-item text-danger"
                                                         icon="pi pi-sign-out" />
                                    </h:form>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>

                <!-- Contenido principal -->
                <div id="content" class="p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="font-weight-bold text-success m-0">Gestión de Envíos</h2>

                        <div class="d-flex">
                            <h:form>
                                <p:commandButton value="Agregar Envío"
                                                 icon="pi pi-plus"
                                                 styleClass="pf-btn-primary mr-2"
                                                 action="#{enviosBean.irAgregarEnviooperario()}"
                                                 ajax="false" />

                                <p:commandButton value="Reporte PDF"
                                                 icon="pi pi-file-pdf"
                                                 styleClass="pf-btn-secondary"
                                                 ajax="false"
                                                 actionListener="#{enviosBean.exportarPDF()}" />
                            </h:form>
                        </div>
                    </div>

                    <!-- Tabla de envíos -->
                    <h:form id="formEnvios">
                        <p:dataTable id="enviosTable"
                                     value="#{enviosBean.listaEnvios}"
                                     var="e"
                                     paginator="true"
                                     rows="5"
                                     widgetVar="enviosTableWV"
                                     emptyMessage="No hay registros de envíos"
                                     style="width:100%;"
                                     styleClass="tabla-usuarios table-custom ui-responsive"
                                     paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}  {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="5,10,20">

                            <f:facet name="header">
                                <div class="d-flex align-items-center justify-content-between w-100">
                                    <div><strong>Lista de Envíos</strong></div>
                                    <div class="small text-muted">
                                        Total: <span>#{enviosBean.listaEnvios != null ? enviosBean.listaEnvios.size() : 0}</span>
                                    </div>
                                </div>
                            </f:facet>

                            <p:column headerText="ID" style="width:5em">
                                <h:outputText value="#{e.idenvio}" />
                            </p:column>

                            <p:column headerText="Estado">
                                <h:outputText value="#{e.estado_envio}" />
                            </p:column>

                            <p:column headerText="Fecha Envío">
                                <h:outputText value="#{e.fecha_envio}">
                                    <f:convertDateTime pattern="yyyy-MM-dd" />
                                </h:outputText>
                            </p:column>

                            <p:column headerText="Fecha Entrega">
                                <h:outputText value="#{e.fecha_entrega}">
                                    <f:convertDateTime pattern="yyyy-MM-dd" />
                                </h:outputText>
                            </p:column>

                            <p:column headerText="Dirección Envío">
                                <h:outputText value="#{e.direccion_envio}" />
                            </p:column>

                            <p:column headerText="Dirección Salida">
                                <h:outputText value="#{e.direccion_salida}" />
                            </p:column>

                            <p:column headerText="Mensajería">
                                <h:outputText value="#{e.fk_mensajeria}" />
                            </p:column>

                            <p:column headerText="Usuario">
                                <h:outputText value="#{e.usuarios_id_usuario}" />
                            </p:column>

                            <p:column headerText="Acciones" style="width:12em; text-align:center;">
                                <p:commandButton value="Editar"
                                                 icon="pi pi-pencil"
                                                 action="#{enviosBean.irEditarEnviooperario(e)}"
                                                 ajax="false"
                                                 styleClass="pf-btn-edit mr-2" />

                                <p:commandButton value="Eliminar"
                                                 icon="pi pi-trash"
                                                 action="#{enviosBean.eliminarEnvio(e.idenvio)}"
                                                 ajax="false"
                                                 styleClass="pf-btn-delete"
                                                 onclick="return confirm('¿Seguro que deseas eliminar este envío?');" />
                            </p:column>
                        </p:dataTable>
                    </h:form>
                </div>
            </div>
        </div>

        <!-- Script de búsqueda -->
        <h:outputScript target="body">
            function filtrarEnvios() {
            var q = document.getElementById('globalSearch').value.toLowerCase();
            var rows = document.querySelectorAll('.tabla-usuarios table tbody tr');
            rows.forEach(r => {
            r.style.display = r.innerText.toLowerCase().includes(q) ? '' : 'none';
            });
            }
        </h:outputScript>

        <!-- Scripts Bootstrap -->
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>
    </h:body>
</html>
